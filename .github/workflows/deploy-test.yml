name: Docker Image CI publish and deploy a test.


# variables
# develop --> the watched brach
# test-auth --> the name of the project

on:
  push:
    branches:
      - "develop"
  pull_request:
    branches:
      - "develop"

jobs:

  build-publish-deploy:
    name: build and push docker
    runs-on: ubuntu-latest
    steps:

    - name: checkout to develop
      uses: actions/checkout@v2
      with:
        ref: develop

    - name: Build
      run: |
        chmod +x build.sh
        ./build.sh test

    - name: push Image
      run: |
        sudo docker images
        sudo docker login --username ${{ secrets.DOCKER_USERNAME }} --password ${{ secrets.DOCKER_PASSWORD }}
        sudo docker push ${{ secrets.DOCKER_USERNAME }}/test-auth:latest
